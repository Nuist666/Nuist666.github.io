<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Nuist666的个人博客</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Nuist666的个人博客">
<meta property="og:url" content="https://nuist666.github.io/page/5/index.html">
<meta property="og:site_name" content="Nuist666的个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Nuist666">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Nuist666的个人博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 7.1.1"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">Nuist666</a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Nuist666" title="github">github</a>
					        
								<a class="mail" target="_blank" href="mailto:202183290043@gmail.com" title="mail">mail</a>
					        
								<a class="weibo" target="_blank" href="https://weibo.com/u/5586096129" title="weibo">weibo</a>
					        
								<a class="twitter" target="_blank" href="https://twitter.com/nuist_666" title="twitter">twitter</a>
					        
						</div>
						<!-- music -->
						
							<!-- <div style="position: absolute; bottom: 120px; left: auto; width: 85%;"> -->
							<div style="position: absolute; left: auto; width: 85%;">
								<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=220 height=86 src="//music.163.com/outchain/player?type=2&id=28411862&auto=1&height=66"></iframe>
							</div>
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Overflow-Mirai-LLOneBot-OneBot/" style="font-size: 10px;">Overflow,Mirai,LLOneBot,OneBot</a> <a href="/tags/python-%E6%B0%94%E8%B1%A1%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%B7%A5%E7%A8%8B/" style="font-size: 20px;">python,气象信息系统工程</a> <a href="/tags/%E5%8D%8E%E4%B8%BA%E4%BA%91-%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2-Hexo/" style="font-size: 10px;">华为云,个人博客,Hexo</a> <a href="/tags/%E6%A8%A1%E6%9D%BF-%E5%B0%8F%E4%B9%A6%E5%8C%A0-%E4%B8%89%E5%B3%B0%E7%9C%9F%E7%99%BD-%E6%96%B0%E5%BB%BA/" style="font-size: 10px;">模板,小书匠,三峰真白,新建</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://qm.qq.com/q/HrJvHGMzek">qq</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://space.bilibili.com/3546647772531174">bilibili</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">I&#39;m a student in NUIST.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

<img src="1" onerror="localStorage.setItem('modelId','25')" style="display: none;">

<script>

// live2d_path 参数建议使用绝对路径
const live2d_path = "https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/";
//const live2d_path = "/live2d-widget/";

// 封装异步加载资源的方法
function loadExternalResource(url, type) {
	return new Promise((resolve, reject) => {
		let tag;

		if (type === "css") {
			tag = document.createElement("link");
			tag.rel = "stylesheet";
			tag.href = url;
		}
		else if (type === "js") {
			tag = document.createElement("script");
			tag.src = url;
		}
		if (tag) {
			tag.onload = () => resolve(url);
			tag.onerror = () => reject(url);
			document.head.appendChild(tag);
		}
	});
}

// 加载 waifu.css live2d.min.js waifu-tips.js
if (screen.width >= 768) {
	Promise.all([
		loadExternalResource(live2d_path + "waifu.css", "css"),
		loadExternalResource(live2d_path + "live2d.min.js", "js"),
		loadExternalResource(live2d_path + "waifu-tips.js", "js")
	]).then(() => {
		// 配置选项的具体用法见 README.md
		initWidget({
			waifuPath: live2d_path + "waifu-tips.json",
			apiPath: "https://api.zsq.im/live2d/",
			//cdnPath: "https://fastly.jsdelivr.net/gh/fghrsh/live2d_api/",
			tools: ["hitokoto", "asteroids", "switch-model", "switch-texture", "photo", "info", "quit"]
		});
	});
}

console.log(`
  く__,.ヘヽ.        /  ,ー､ 〉
           ＼ ', !-─‐-i  /  /´
           ／｀ｰ'       L/／｀ヽ､
         /   ／,   /|   ,   ,       ',
       ｲ   / /-‐/  ｉ  L_ ﾊ ヽ!   i
        ﾚ ﾍ 7ｲ｀ﾄ   ﾚ'ｧ-ﾄ､!ハ|   |
          !,/7 '0'     ´0iソ|    |
          |.从"    _     ,,,, / |./    |
          ﾚ'| i＞.､,,__  _,.イ /   .i   |
            ﾚ'| | / k_７_/ﾚ'ヽ,  ﾊ.  |
              | |/i 〈|/   i  ,.ﾍ |  i  |
             .|/ /  ｉ：    ﾍ!    ＼  |
              kヽ>､ﾊ    _,.ﾍ､    /､!
              !'〈//｀Ｔ´', ＼ ｀'7'ｰr'
              ﾚ'ヽL__|___i,___,ンﾚ|ノ
                  ﾄ-,/  |___./
                  'ｰ'    !_,.:
`);

</script>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/avatar.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Nuist666" title="github">github</a>
			        
						<a class="mail" target="_blank" href="mailto:202183290043@gmail.com" title="mail">mail</a>
			        
						<a class="weibo" target="_blank" href="https://weibo.com/u/5586096129" title="weibo">weibo</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/nuist_666" title="twitter">twitter</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-第十一章" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2000/01/01/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0/" class="article-date">
  	<time datetime="1999-12-31T16:11:00.000Z" itemprop="datePublished">2000-01-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2000/01/01/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0/">
        python气象信息系统工程 第十一章
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="第11章-常用气象统计方法与检验"><a href="#第11章-常用气象统计方法与检验" class="headerlink" title="第11章 常用气象统计方法与检验"></a>第11章 常用气象统计方法与检验</h1><h2 id="11-1-基本气候状态统计量"><a href="#11-1-基本气候状态统计量" class="headerlink" title="11.1  基本气候状态统计量"></a>11.1  基本气候状态统计量</h2><h3 id="11-1-1-中心趋势统计量"><a href="#11-1-1-中心趋势统计量" class="headerlink" title="11.1.1  中心趋势统计量"></a>11.1.1  中心趋势统计量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">station1 = np.array([<span class="number">27</span>,<span class="number">29</span>,<span class="number">28</span>,<span class="number">26</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">28</span>])</span><br><span class="line">station2 = np.array([<span class="number">32</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">33</span>,np.nan,<span class="number">33</span>,<span class="number">36</span>])</span><br><span class="line"><span class="built_in">print</span>(np.mean(station1))</span><br><span class="line"><span class="built_in">print</span>(np.mean(station2))</span><br><span class="line"><span class="built_in">print</span>(np.nanmean(station1))</span><br><span class="line"><span class="built_in">print</span>(np.nanmean(station2))</span><br></pre></td></tr></table></figure>

<pre><code>26.714285714285715
nan
26.714285714285715
32.166666666666664
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">data = np.array([[<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>], [<span class="number">7</span>,<span class="number">5</span>,<span class="number">3</span>]])</span><br><span class="line"><span class="built_in">print</span>(np.percentile(data, <span class="number">50</span>))</span><br><span class="line"><span class="built_in">print</span>(np.percentile(data, <span class="number">50</span>, axis=<span class="number">0</span>, interpolation=<span class="string">&#x27;lower&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(np.percentile(data, <span class="number">50</span>, axis=<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(np.percentile(data, <span class="number">50</span>, axis=<span class="number">1</span>, keepdims=<span class="literal">True</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>4.0
[1 3 3]
[3. 5.]
[[3.]
 [5.]]
</code></pre>
<h3 id="11-1-2-变化幅度统计量"><a href="#11-1-2-变化幅度统计量" class="headerlink" title="11.1.2  变化幅度统计量"></a>11.1.2  变化幅度统计量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">data = np.array([<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">3</span>])</span><br><span class="line">data_anomaly = data - data.mean()</span><br><span class="line"><span class="built_in">print</span>(data_anomaly)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>[-3.16666667 -1.16666667  1.83333333  2.83333333  0.83333333 -1.16666667]
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">data = np.array([<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">3</span>,np.nan])</span><br><span class="line">std1 =  np.std(data)</span><br><span class="line">std2 =  np.nanstd(data)</span><br><span class="line"><span class="built_in">print</span>(std1)</span><br><span class="line"><span class="built_in">print</span>(std2)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>nan
2.034425935955617
</code></pre>
<h3 id="11-1-3-相关统计量"><a href="#11-1-3-相关统计量" class="headerlink" title="11.1.3  相关统计量"></a>11.1.3  相关统计量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xarray <span class="keyword">as</span> xr</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> cartopy.crs <span class="keyword">as</span> ccrs</span><br><span class="line"><span class="keyword">import</span> cartopy.feature <span class="keyword">as</span> cfeature</span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> pearsonr</span><br><span class="line"><span class="keyword">import</span> cartopy.mpl.ticker <span class="keyword">as</span> cticker</span><br><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">f = xr.open_dataset(<span class="string">&#x27;/home/mw/input/pythonbook4259/data.nc&#x27;</span>)</span><br><span class="line">a = f[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">b = f[<span class="string">&#x27;b&#x27;</span>]</span><br><span class="line">lat = f[<span class="string">&#x27;lat&#x27;</span>]</span><br><span class="line">lon = f[<span class="string">&#x27;lon&#x27;</span>]</span><br><span class="line"><span class="comment">#创建两个大小为[nlat,nlon]的数组存放相关系数及p值</span></span><br><span class="line">r = np.zeros((b.shape[<span class="number">1</span>],b.shape[<span class="number">2</span>]))</span><br><span class="line">p = np.zeros((b.shape[<span class="number">1</span>],b.shape[<span class="number">2</span>]))</span><br><span class="line"><span class="comment">#循环计算相关系数</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.arange(b.shape[<span class="number">1</span>]):</span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> np.arange(b.shape[<span class="number">2</span>]):</span><br><span class="line">      r[i,j],p[i,j] = pearsonr(b[:,i,j],a)</span><br><span class="line"><span class="comment">#绘图</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">15</span>, <span class="number">12</span>))</span><br><span class="line">ax = fig.add_subplot(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>, projection=ccrs.PlateCarree())</span><br><span class="line">ax.set_extent([-<span class="number">90</span>,<span class="number">30</span>,<span class="number">0</span>,<span class="number">90</span>])</span><br><span class="line">ax.set_xticks(np.arange(-<span class="number">90</span>,<span class="number">60</span>,<span class="number">30</span>), crs=ccrs.PlateCarree())</span><br><span class="line">ax.set_yticks(np.arange(<span class="number">0</span>,<span class="number">120</span>,<span class="number">30</span>), crs=ccrs.PlateCarree())</span><br><span class="line">ax.xaxis.set_major_formatter(cticker.LongitudeFormatter())</span><br><span class="line">ax.yaxis.set_major_formatter(cticker.LatitudeFormatter())</span><br><span class="line"><span class="comment">#绘制相关系数分布图</span></span><br><span class="line">c1 = ax.contourf(lon, lat, r,levels=np.arange(-<span class="number">1</span>,<span class="number">1.1</span>,<span class="number">0.1</span>),extend=<span class="string">&#x27;both&#x27;</span>,cmap=<span class="string">&#x27;bwr&#x27;</span>,zorder=<span class="number">1</span>,transform=ccrs.PlateCarree())</span><br><span class="line"><span class="comment">#对通过90%显著性检验的区域打点，即将p值为0～0.1的区域覆盖上“…”标记</span></span><br><span class="line">c2 = ax.contourf(lon,lat, p, [<span class="number">0</span>,<span class="number">0.1</span>,<span class="number">1</span>] , zorder=<span class="number">1</span>,hatches=[<span class="string">&#x27;...&#x27;</span>, <span class="literal">None</span>],colors=<span class="string">&quot;none&quot;</span>, transform=ccrs.PlateCarree())</span><br><span class="line"><span class="comment">#添加色标</span></span><br><span class="line">fig.colorbar(c1,ax=ax,fraction=<span class="number">0.032</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Warning: ecCodes 2.21.0 or higher is recommended. You are running version 2.14.1


/opt/conda/lib/python3.7/site-packages/scipy/stats/stats.py:3399: PearsonRConstantInputWarning: An input array is constant; the correlation coefficent is not defined.
  warnings.warn(PearsonRConstantInputWarning())





&lt;matplotlib.colorbar.Colorbar at 0x7f0d56cee1d0&gt;
</code></pre>
<img src="https://cdn.kesci.com/upload/rt/E3C094DBA98844368A680CE93D09D99F/rpnezirtmk.png">



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xarray <span class="keyword">as</span> xr</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> cartopy.crs <span class="keyword">as</span> ccrs</span><br><span class="line"><span class="keyword">import</span> cartopy.feature <span class="keyword">as</span> cfeature</span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> linregress</span><br><span class="line"><span class="keyword">import</span> cartopy.mpl.ticker <span class="keyword">as</span> cticker</span><br><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">f = xr.open_dataset(<span class="string">&#x27;/home/mw/input/pythonbook4259/data.nc&#x27;</span>)</span><br><span class="line">a = f[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line">b = f[<span class="string">&#x27;b&#x27;</span>]</span><br><span class="line">lat = f[<span class="string">&#x27;lat&#x27;</span>]</span><br><span class="line">lon = f[<span class="string">&#x27;lon&#x27;</span>]</span><br><span class="line"><span class="comment">#创建两个大小为[nlat,nlon]的数组存放相关系数及p值</span></span><br><span class="line">slope = np.zeros((b.shape[<span class="number">1</span>],b.shape[<span class="number">2</span>]))</span><br><span class="line">intercept = np.zeros((b.shape[<span class="number">1</span>],b.shape[<span class="number">2</span>]))</span><br><span class="line">r = np.zeros((b.shape[<span class="number">1</span>],b.shape[<span class="number">2</span>]))</span><br><span class="line">p = np.zeros((b.shape[<span class="number">1</span>],b.shape[<span class="number">2</span>]))</span><br><span class="line">std_err = np.zeros((b.shape[<span class="number">1</span>],b.shape[<span class="number">2</span>]))<span class="comment">#循环计算相关系数</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.arange(b.shape[<span class="number">1</span>]):</span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> np.arange(b.shape[<span class="number">2</span>]):</span><br><span class="line">      slope[i,j],intercept[i,j],r[i,j],p[i,j],std_err[i,j] = linregress(b[:,i,j],a)</span><br><span class="line"><span class="comment">#绘图</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">15</span>, <span class="number">12</span>))</span><br><span class="line">ax = fig.add_subplot(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>, projection=ccrs.PlateCarree())</span><br><span class="line">ax.set_extent([-<span class="number">90</span>,<span class="number">30</span>,<span class="number">0</span>,<span class="number">90</span>])</span><br><span class="line">ax.set_xticks(np.arange(-<span class="number">90</span>,<span class="number">60</span>,<span class="number">30</span>), crs=ccrs.PlateCarree())</span><br><span class="line">ax.set_yticks(np.arange(<span class="number">0</span>,<span class="number">120</span>,<span class="number">30</span>), crs=ccrs.PlateCarree())</span><br><span class="line">ax.xaxis.set_major_formatter(cticker.LongitudeFormatter())</span><br><span class="line">ax.yaxis.set_major_formatter(cticker.LatitudeFormatter())</span><br><span class="line"><span class="comment">#绘制相关系数分布图</span></span><br><span class="line">c1 = ax.contourf(lon, lat, slope,levels=np.arange(-<span class="number">1</span>,<span class="number">1.1</span>,<span class="number">0.1</span>),extend=<span class="string">&#x27;both&#x27;</span>,cmap=<span class="string">&#x27;bwr&#x27;</span>,zorder=<span class="number">1</span>,transform=ccrs.PlateCarree())</span><br><span class="line"><span class="comment">#对通过90%显著性检验的区域打点，即将p值为0～0.1的区域覆盖上“…”标记</span></span><br><span class="line">c2 = ax.contourf(lon,lat, p, [<span class="number">0</span>,<span class="number">0.1</span>,<span class="number">1</span>] , zorder=<span class="number">1</span>,hatches=[<span class="string">&#x27;...&#x27;</span>, <span class="literal">None</span>],colors=<span class="string">&quot;none&quot;</span>, transform=ccrs.PlateCarree())</span><br><span class="line"><span class="comment">#添加色标</span></span><br><span class="line">fig.colorbar(c1,ax=ax,fraction=<span class="number">0.032</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>/opt/conda/lib/python3.7/site-packages/scipy/stats/_stats_mstats_common.py:130: RuntimeWarning: invalid value encountered in double_scalars
  slope = r_num / ssxm
/opt/conda/lib/python3.7/site-packages/scipy/stats/_stats_mstats_common.py:142: RuntimeWarning: divide by zero encountered in double_scalars
  sterrest = np.sqrt((1 - r**2) * ssym / ssxm / df)





&lt;matplotlib.colorbar.Colorbar at 0x7f0d5679f2d0&gt;
</code></pre>
<img src="https://cdn.kesci.com/upload/rt/4334BD88325A44C6AB52B95F81AB8840/rpnf3hzs85.png">


<h3 id="11-1-4-数据标准化"><a href="#11-1-4-数据标准化" class="headerlink" title="11.1.4  数据标准化"></a>11.1.4  数据标准化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment">#原始值</span></span><br><span class="line">x = np.array([<span class="number">15.4</span>,<span class="number">14.6</span>,<span class="number">15.8</span>,<span class="number">14.8</span>,<span class="number">15.0</span>,<span class="number">15.1</span>,<span class="number">15.1</span>,<span class="number">15.0</span>,<span class="number">15.2</span>,<span class="number">15.4</span>,</span><br><span class="line">            <span class="number">14.8</span>,<span class="number">15.0</span>,<span class="number">15.1</span>,<span class="number">14.7</span>,<span class="number">16.0</span>,<span class="number">15.7</span>,<span class="number">15.4</span>,<span class="number">14.5</span>,<span class="number">15.1</span>,<span class="number">15.3</span>,</span><br><span class="line">            <span class="number">15.5</span>,<span class="number">15.1</span>,<span class="number">15.6</span>,<span class="number">15.1</span>,<span class="number">15.1</span>,<span class="number">14.9</span>,<span class="number">15.5</span>,<span class="number">15.3</span>,<span class="number">15.3</span>,<span class="number">15.4</span>,</span><br><span class="line">            <span class="number">15.7</span>,<span class="number">15.2</span>,<span class="number">15.5</span>,<span class="number">15.5</span>,<span class="number">15.6</span>,<span class="number">15.1</span>,<span class="number">15.1</span>,<span class="number">16.0</span>,<span class="number">16.0</span>,<span class="number">16.8</span>,</span><br><span class="line">            <span class="number">16.2</span>,<span class="number">16.2</span>,<span class="number">16.0</span>,<span class="number">15.6</span>,<span class="number">15.9</span>,<span class="number">16.2</span>,<span class="number">16.7</span>,<span class="number">15.8</span>,<span class="number">16.2</span>,<span class="number">15.9</span>,</span><br><span class="line">            <span class="number">15.8</span>,<span class="number">15.5</span>,<span class="number">15.9</span>,<span class="number">16.8</span>,<span class="number">15.5</span>,<span class="number">15.8</span>,<span class="number">15.0</span>,<span class="number">14.9</span>,<span class="number">15.3</span>,<span class="number">16.0</span>,</span><br><span class="line">            <span class="number">16.1</span>,<span class="number">16.5</span>,<span class="number">15.5</span>,<span class="number">15.6</span>,<span class="number">16.1</span>,<span class="number">15.6</span>,<span class="number">16.0</span>,<span class="number">15.4</span>,<span class="number">15.5</span>,<span class="number">15.2</span>,</span><br><span class="line">            <span class="number">15.4</span>,<span class="number">15.6</span>,<span class="number">15.1</span>,<span class="number">15.8</span>,<span class="number">15.5</span>,<span class="number">16.0</span>,<span class="number">15.2</span>,<span class="number">15.8</span>,<span class="number">16.2</span>,<span class="number">16.2</span>,</span><br><span class="line">            <span class="number">15.2</span>,<span class="number">15.7</span>,<span class="number">16.0</span>,<span class="number">16.0</span>,<span class="number">15.7</span>,<span class="number">15.9</span>,<span class="number">15.7</span>,<span class="number">16.7</span>,<span class="number">15.3</span>,<span class="number">16.1</span>])</span><br><span class="line"><span class="comment">#标准化</span></span><br><span class="line">x_std = (x - x.mean(axis=<span class="number">0</span>))/x.std(axis=<span class="number">0</span>)</span><br><span class="line">fig = plt.figure(figsize=(<span class="number">15</span>,<span class="number">15</span>))</span><br><span class="line"><span class="comment">#原始序列</span></span><br><span class="line">ax1 = fig.add_axes([<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.4</span>, <span class="number">0.3</span>])</span><br><span class="line">ax1.plot(np.arange(<span class="number">1900</span>,<span class="number">1990</span>,<span class="number">1</span>),x,<span class="string">&#x27;k&#x27;</span>)</span><br><span class="line">ax1.set_title(<span class="string">&#x27;Original value&#x27;</span>)</span><br><span class="line"><span class="comment">#标准化后</span></span><br><span class="line">ax2 = fig.add_axes([<span class="number">0.55</span>, <span class="number">0.1</span>, <span class="number">0.4</span>, <span class="number">0.3</span>])</span><br><span class="line">ax2.plot(np.arange(<span class="number">1900</span>,<span class="number">1990</span>,<span class="number">1</span>),x_std,<span class="string">&#x27;k&#x27;</span>)</span><br><span class="line">ax2.set_title(<span class="string">&#x27;Normalized values&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<pre><code>Text(0.5, 1.0, &#39;Normalized values&#39;)
</code></pre>
<img src="https://cdn.kesci.com/upload/rt/45C01F3BECD94B73BE8344DC783D094E/rpnf3hki1k.png">


<h2 id="11-2-气候变化趋势分析"><a href="#11-2-气候变化趋势分析" class="headerlink" title="11.2  气候变化趋势分析"></a>11.2  气候变化趋势分析</h2><h3 id="11-2-1-拟合"><a href="#11-2-1-拟合" class="headerlink" title="11.2.1  拟合"></a>11.2.1  拟合</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment">#创建数据</span></span><br><span class="line">x = np.arange(<span class="number">2000</span>,<span class="number">2011</span>,<span class="number">1</span>)</span><br><span class="line">y = np.array([<span class="number">3.9</span>, <span class="number">4.4</span>, <span class="number">10.8</span>, <span class="number">10.3</span>, <span class="number">11.2</span>, <span class="number">13.1</span>, <span class="number">14.1</span>,  <span class="number">9.9</span>, <span class="number">13.9</span>, <span class="number">15.1</span>, <span class="number">12.5</span>]).reshape(-<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"><span class="comment">#创建回归模型</span></span><br><span class="line">a1, b1 = np.polyfit(x, y, deg=<span class="number">1</span>)  <span class="comment">#对x、y进行拟合</span></span><br><span class="line">y_fit1 = a1*x + b1  <span class="comment">#拟合出的直线</span></span><br><span class="line">a2, b2,c2 = np.polyfit(x, y, deg=<span class="number">2</span>)  <span class="comment">#对x、y进行拟合</span></span><br><span class="line">y_fit2 = a2*x*x +b2*x+c2  <span class="comment">#拟合出的直线</span></span><br><span class="line"><span class="comment">#绘图</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>, <span class="number">4</span>))</span><br><span class="line">ax1 = fig.add_subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">ax1.plot(x, y_fit1, <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">ax1.plot(x, y, <span class="string">&#x27;o&#x27;</span>, color=<span class="string">&#x27;tab:brown&#x27;</span>)</span><br><span class="line">ax1.text(<span class="number">2001</span>,<span class="number">6</span>,<span class="string">&#x27;y = &#123;&#125;x+&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(a1.<span class="built_in">round</span>(<span class="number">2</span>)[<span class="number">0</span>],b1.<span class="built_in">round</span>(<span class="number">2</span>)[<span class="number">0</span>]),fontsize=<span class="number">12</span>)</span><br><span class="line">ax2 = fig.add_subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">ax2.plot(x, y_fit2, <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">ax2.plot(x, y, <span class="string">&#x27;o&#x27;</span>, color=<span class="string">&#x27;tab:brown&#x27;</span>)</span><br><span class="line">ax2.text(<span class="number">2001</span>,<span class="number">6</span>,<span class="string">&#x27;y = &#123;&#125;x+&#123;&#125;x+&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(a2.<span class="built_in">round</span>(<span class="number">2</span>)[<span class="number">0</span>],b2.<span class="built_in">round</span>(<span class="number">2</span>)[<span class="number">0</span>],c2.<span class="built_in">round</span>(<span class="number">2</span>)[<span class="number">0</span>]),fontsize=<span class="number">12</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<img src="https://cdn.kesci.com/upload/rt/CA2513219F1B4FB08AB076DC363AE408/rpnf3i7vpj.png">


<h3 id="11-2-2-滑动平均"><a href="#11-2-2-滑动平均" class="headerlink" title="11.2.2  滑动平均"></a>11.2.2  滑动平均</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment">#创建气候序列y</span></span><br><span class="line">y = np.array([<span class="number">6.08</span>, <span class="number">4.56</span>, <span class="number">5.63</span>, <span class="number">5.31</span>, <span class="number">5.15</span>, <span class="number">5.44</span>, <span class="number">4.65</span>, <span class="number">4.24</span>, <span class="number">7.3</span>,  <span class="number">5.86</span>, <span class="number">4.51</span>, <span class="number">6.28</span>, <span class="number">5.55</span>, <span class="number">5.35</span>,</span><br><span class="line"><span class="number">5.12</span>, <span class="number">4.76</span>, <span class="number">4.35</span>, <span class="number">3.76</span>, <span class="number">4.74</span>, <span class="number">5.55</span>, <span class="number">4.54</span>, <span class="number">5.74</span>, <span class="number">5.54</span>, <span class="number">3.67</span>, <span class="number">4.77</span>, <span class="number">4.9</span>,  <span class="number">3.06</span>, <span class="number">3.9</span>,</span><br><span class="line"><span class="number">4.18</span>, <span class="number">5.44</span>, <span class="number">5.21</span>, <span class="number">3.86</span>, <span class="number">3.96</span>, <span class="number">4.47</span>, <span class="number">4.37</span>, <span class="number">4.86</span>, <span class="number">4.43</span>, <span class="number">3.63</span>, <span class="number">3.98</span>, <span class="number">3.94</span>, <span class="number">5.09</span>, <span class="number">4.48</span>,</span><br><span class="line"><span class="number">4.05</span>, <span class="number">4.81</span>, <span class="number">4.07</span>, <span class="number">4.48</span>, <span class="number">4.46</span>, <span class="number">3.95</span>, <span class="number">5.24</span>, <span class="number">3.54</span>, <span class="number">3.11</span>, <span class="number">5.07</span>, <span class="number">6.09</span>, <span class="number">4.59</span>, <span class="number">4.55</span>, <span class="number">4.7</span>,</span><br><span class="line"><span class="number">3.43</span>, <span class="number">4.37</span>, <span class="number">4.79</span>, <span class="number">3.64</span>, <span class="number">4.3</span>,  <span class="number">3.5</span> ])</span><br><span class="line"><span class="comment">#创建一个9年滑动平均的卷积核</span></span><br><span class="line">v= np.repeat(<span class="number">1</span>/<span class="number">9</span>, <span class="number">9</span>)</span><br><span class="line"><span class="comment">#滑动平均</span></span><br><span class="line">y_smooth9_full = np.convolve(y,v,<span class="string">&#x27;full&#x27;</span>)</span><br><span class="line">y_smooth9_same = np.convolve(y,v,<span class="string">&#x27;same&#x27;</span>)</span><br><span class="line">y_smooth9_valid = np.convolve(y,v,<span class="string">&#x27;valid&#x27;</span>)</span><br><span class="line"><span class="comment">#绘图</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>, <span class="number">4</span>))</span><br><span class="line">ax1 = fig.add_subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">ax1.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),y,label=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">ax1.set_xlim(<span class="number">0</span>,<span class="number">60</span>)</span><br><span class="line">ax1.set_ylim(<span class="number">2</span>,<span class="number">8</span>)</span><br><span class="line">ax1.set_title(<span class="string">&#x27;Original value&#x27;</span>)</span><br><span class="line">ax2 = fig.add_subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">ax2.plot(np.arange(-<span class="number">4</span>,<span class="number">62</span>+<span class="number">4</span>,<span class="number">1</span>),y_smooth9_full,label=<span class="string">&#x27;full&#x27;</span>)</span><br><span class="line">ax2.set_xlim(<span class="number">0</span>,<span class="number">60</span>)</span><br><span class="line">ax2.set_ylim(<span class="number">2</span>,<span class="number">8</span>)</span><br><span class="line">ax2.set_title(<span class="string">&#x27;mode = full&#x27;</span>)</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">ax3.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),y_smooth9_same,label=<span class="string">&#x27;same&#x27;</span>)</span><br><span class="line">ax3.set_xlim(<span class="number">0</span>,<span class="number">60</span>)</span><br><span class="line">ax3.set_ylim(<span class="number">2</span>,<span class="number">8</span>)</span><br><span class="line">ax3.set_title(<span class="string">&#x27;mode = same&#x27;</span>)</span><br><span class="line">ax4 = fig.add_subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line">ax4.plot(np.arange(<span class="number">0</span>+<span class="number">4</span>,<span class="number">62</span>-<span class="number">4</span>,<span class="number">1</span>),y_smooth9_valid,label=<span class="string">&#x27;valid&#x27;</span>)</span><br><span class="line">ax4.set_xlim(<span class="number">0</span>,<span class="number">60</span>)</span><br><span class="line">ax4.set_ylim(<span class="number">2</span>,<span class="number">8</span>)</span><br><span class="line">ax4.set_title(<span class="string">&#x27;mode = valid&#x27;</span>)</span><br><span class="line"><span class="comment">#防止图题被遮挡</span></span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<img src="https://cdn.kesci.com/upload/rt/7466F3862FA345EAA7A0681EAA5F91FB/rpnf3in3o3.png">


<h3 id="11-2-3-去趋势"><a href="#11-2-3-去趋势" class="headerlink" title="11.2.3  去趋势"></a>11.2.3  去趋势</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">y = np.array([<span class="number">6.08</span>, <span class="number">4.56</span>, <span class="number">5.63</span>, <span class="number">5.31</span>, <span class="number">5.15</span>, <span class="number">5.44</span>, <span class="number">4.65</span>, <span class="number">4.24</span>, <span class="number">7.3</span>,  <span class="number">5.86</span>, <span class="number">4.51</span>, <span class="number">6.28</span>, <span class="number">5.55</span>, <span class="number">5.35</span>,</span><br><span class="line"><span class="number">5.12</span>, <span class="number">4.76</span>, <span class="number">4.35</span>, <span class="number">3.76</span>, <span class="number">4.74</span>, <span class="number">5.55</span>, <span class="number">4.54</span>, <span class="number">5.74</span>, <span class="number">5.54</span>, <span class="number">3.67</span>, <span class="number">4.77</span>, <span class="number">4.9</span>,  <span class="number">3.06</span>, <span class="number">3.9</span>,</span><br><span class="line"><span class="number">4.18</span>, <span class="number">5.44</span>, <span class="number">5.21</span>, <span class="number">3.86</span>, <span class="number">3.96</span>, <span class="number">4.47</span>, <span class="number">4.37</span>, <span class="number">4.86</span>, <span class="number">4.43</span>, <span class="number">3.63</span>, <span class="number">3.98</span>, <span class="number">3.94</span>, <span class="number">5.09</span>, <span class="number">4.48</span>,</span><br><span class="line"><span class="number">4.05</span>, <span class="number">4.81</span>, <span class="number">4.07</span>, <span class="number">4.48</span>, <span class="number">4.46</span>, <span class="number">3.95</span>, <span class="number">5.24</span>, <span class="number">3.54</span>, <span class="number">3.11</span>, <span class="number">5.07</span>, <span class="number">6.09</span>, <span class="number">4.59</span>, <span class="number">4.55</span>, <span class="number">4.7</span>,</span><br><span class="line"><span class="number">3.43</span>, <span class="number">4.37</span>, <span class="number">4.79</span>, <span class="number">3.64</span>, <span class="number">4.3</span>,  <span class="number">3.5</span> ])</span><br><span class="line">y_detrend_linear = signal.detrend(y,axis = <span class="number">0</span>,<span class="built_in">type</span>=<span class="string">&#x27;linear&#x27;</span>)</span><br><span class="line">y_detrend_constant = signal.detrend(y,axis = <span class="number">0</span>,<span class="built_in">type</span>=<span class="string">&#x27;constant&#x27;</span>)</span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>, <span class="number">4</span>))</span><br><span class="line">ax1 = fig.add_subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">ax1.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),y,<span class="string">&#x27;k&#x27;</span>,label=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">ax1.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),y_detrend_linear+y.mean(),<span class="string">&#x27;r&#x27;</span>,label=<span class="string">&#x27;linear&#x27;</span>)</span><br><span class="line">ax1.legend()</span><br><span class="line">ax2 = fig.add_subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">ax2.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),y,<span class="string">&#x27;k&#x27;</span>,label=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">ax2.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),y_detrend_constant,<span class="string">&#x27;r&#x27;</span>,label=<span class="string">&#x27;constant&#x27;</span>)</span><br><span class="line">ax2.legend()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<img src="https://cdn.kesci.com/upload/rt/E5F78290F8C14112911C075F4DC1921A/rpnf3i5377.png">


<h3 id="11-2-4-滤波"><a href="#11-2-4-滤波" class="headerlink" title="11.2.4  滤波"></a>11.2.4  滤波</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">y = np.array([ <span class="number">1.74082189</span>, -<span class="number">0.12322827</span>,  <span class="number">1.18896494</span>,  <span class="number">0.79653332</span>,  <span class="number">0.60031752</span>,  <span class="number">0.95595867</span>,</span><br><span class="line"> -<span class="number">0.01285688</span>, -<span class="number">0.51565989</span>,  <span class="number">3.23696743</span>,  <span class="number">1.47102516</span>, -<span class="number">0.18454571</span>,  <span class="number">1.98609165</span>,</span><br><span class="line">  <span class="number">1.09085703</span>,  <span class="number">0.84558727</span>,  <span class="number">0.56352705</span>,  <span class="number">0.12204148</span>, -<span class="number">0.38076152</span>, -<span class="number">1.10430731</span>,</span><br><span class="line">  <span class="number">0.09751451</span>,  <span class="number">1.09085703</span>, -<span class="number">0.14775525</span>,  <span class="number">1.3238633</span>,  <span class="number">1.07859355</span>,  -<span class="number">1.2146787</span>,</span><br><span class="line">  <span class="number">0.13430497</span>,  <span class="number">0.29373032</span>, -<span class="number">1.96275147</span>, -<span class="number">0.93261848</span>, -<span class="number">0.58924082</span>,  <span class="number">0.95595867</span>,</span><br><span class="line">  <span class="number">0.67389844</span>, -<span class="number">0.98167243</span>, -<span class="number">0.85903755</span>, -<span class="number">0.23359967</span>, -<span class="number">0.35623455</span>,  <span class="number">0.24467636</span>,</span><br><span class="line"> -<span class="number">0.28265362</span>, -<span class="number">1.26373265</span>, -<span class="number">0.83451058</span>, -<span class="number">0.88356453</span>,  <span class="number">0.52673659</span>, -<span class="number">0.22133618</span>,</span><br><span class="line"> -<span class="number">0.74866616</span>,  <span class="number">0.18335892</span>, -<span class="number">0.72413918</span>, -<span class="number">0.22133618</span>, -<span class="number">0.24586315</span>, -<span class="number">0.87130104</span>,</span><br><span class="line">  <span class="number">0.71068891</span>, -<span class="number">1.37410405</span>, -<span class="number">1.90143403</span>,  <span class="number">0.50220961</span>,  <span class="number">1.75308538</span>, -<span class="number">0.08643781</span>,</span><br><span class="line"> -<span class="number">0.13549176</span>,  <span class="number">0.04846056</span>, -<span class="number">1.50900241</span>, -<span class="number">0.35623455</span>,  <span class="number">0.15883195</span>, -<span class="number">1.25146917</span>,</span><br><span class="line"> -<span class="number">0.44207896</span>, -<span class="number">1.423158</span>  ])</span><br><span class="line"><span class="comment">####高通滤波####</span></span><br><span class="line">b1, a1 = signal.butter(<span class="number">3</span>, <span class="number">2</span>/<span class="number">3</span>, <span class="string">&#x27;highpass&#x27;</span>)</span><br><span class="line">high_series = signal.filtfilt(b1, a1, y)</span><br><span class="line"><span class="comment">####带通滤波####获得3～10年的信号</span></span><br><span class="line">b2, a2 = signal.butter(<span class="number">3</span>, [<span class="number">2</span>/<span class="number">10</span>,<span class="number">2</span>/<span class="number">3</span>], <span class="string">&#x27;bandpass&#x27;</span>)</span><br><span class="line">band_series = signal.filtfilt(b2, a2, y)</span><br><span class="line"><span class="comment">####低通滤波####获得10年以上的信号</span></span><br><span class="line">b3, a3 = signal.butter(<span class="number">3</span>, <span class="number">2</span>/<span class="number">10</span>, <span class="string">&#x27;lowpass&#x27;</span>)</span><br><span class="line">low_series = signal.filtfilt(b3, a3, y)</span><br><span class="line"><span class="comment">#绘图</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>, <span class="number">4</span>))</span><br><span class="line">ax1 = fig.add_subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">ax1.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),y,<span class="string">&#x27;k&#x27;</span>,label=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">ax1.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),high_series,<span class="string">&#x27;r&#x27;</span>,label=<span class="string">&#x27;highpass&#x27;</span>)</span><br><span class="line">ax1.legend()</span><br><span class="line">ax2 = fig.add_subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>)</span><br><span class="line">ax2.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),y,<span class="string">&#x27;k&#x27;</span>,label=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">ax2.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),band_series,<span class="string">&#x27;r&#x27;</span>,label=<span class="string">&#x27;bandpass&#x27;</span>)</span><br><span class="line">ax2.legend()</span><br><span class="line">ax3 = fig.add_subplot(<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">ax3.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),y,<span class="string">&#x27;k&#x27;</span>,label=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">ax3.plot(np.arange(<span class="number">0</span>,<span class="number">62</span>,<span class="number">1</span>),low_series,<span class="string">&#x27;r&#x27;</span>,label=<span class="string">&#x27;lowpass&#x27;</span>)</span><br><span class="line">ax3.legend()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<img src="https://cdn.kesci.com/upload/rt/A6837C44AA39421A8BC75C21944F2164/rpnf3j9qk3.png">


<h2 id="11-3-气候序列突变检验"><a href="#11-3-气候序列突变检验" class="headerlink" title="11.3  气候序列突变检验"></a>11.3  气候序列突变检验</h2><h3 id="11-3-1-滑动t检验"><a href="#11-3-1-滑动t检验" class="headerlink" title="11.3.1  滑动t检验"></a>11.3.1  滑动t检验</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">slidet</span>(<span class="params">inputdata,step</span>): <span class="comment">#inputdata为输入的一维气候序列；step为滑动步长，整型</span></span><br><span class="line">   inputdata = np.array(inputdata)</span><br><span class="line">   n = inputdata.shape[<span class="number">0</span>]</span><br><span class="line">   t = np.zeros(n)</span><br><span class="line">   t1 = np.empty(n)</span><br><span class="line">   n1 = step   </span><br><span class="line">   n2 = step</span><br><span class="line">   n11 = <span class="number">1</span> / n1</span><br><span class="line">   n22 = <span class="number">1</span> / n2</span><br><span class="line">   m = np.sqrt(n11 + n22)</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (step, n-step-<span class="number">1</span>):</span><br><span class="line">      x1_mean = np.mean(inputdata[i-step : i])   </span><br><span class="line">      x2_mean = np.mean(inputdata[i : i+step])</span><br><span class="line">      s1 = np.var(inputdata[i-step : i])        </span><br><span class="line">      s2 = np.var(inputdata[i : i+step])</span><br><span class="line">      s = np.sqrt((n1 * s1 + n2 * s2) / (n1 + n2 - <span class="number">2</span>))</span><br><span class="line">      t[i-step] = (x2_mean - x1_mean) / (s * m)</span><br><span class="line">      t1 = np.roll(t , step-<span class="number">1</span>)</span><br><span class="line">      t1[:step]=np.nan  </span><br><span class="line">      t1[n-step+<span class="number">1</span>:]=np.nan          </span><br><span class="line">   <span class="keyword">return</span>  t1  </span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">a = [<span class="number">15.4</span>,<span class="number">14.6</span>,<span class="number">15.8</span>,<span class="number">14.8</span>,<span class="number">15.0</span>,<span class="number">15.1</span>,<span class="number">15.1</span>,<span class="number">15.0</span>,<span class="number">15.2</span>,<span class="number">15.4</span>,</span><br><span class="line">     <span class="number">14.8</span>,<span class="number">15.0</span>,<span class="number">15.1</span>,<span class="number">14.7</span>,<span class="number">16.0</span>,<span class="number">15.7</span>,<span class="number">15.4</span>,<span class="number">14.5</span>,<span class="number">15.1</span>,<span class="number">15.3</span>,</span><br><span class="line">     <span class="number">15.5</span>,<span class="number">15.1</span>,<span class="number">15.6</span>,<span class="number">15.1</span>,<span class="number">15.1</span>,<span class="number">14.9</span>,<span class="number">15.5</span>,<span class="number">15.3</span>,<span class="number">15.3</span>,<span class="number">15.4</span>,</span><br><span class="line">     <span class="number">15.7</span>,<span class="number">15.2</span>,<span class="number">15.5</span>,<span class="number">15.5</span>,<span class="number">15.6</span>,<span class="number">15.1</span>,<span class="number">15.1</span>,<span class="number">16.0</span>,<span class="number">16.0</span>,<span class="number">16.8</span>,</span><br><span class="line">     <span class="number">16.2</span>,<span class="number">16.2</span>,<span class="number">16.0</span>,<span class="number">15.6</span>,<span class="number">15.9</span>,<span class="number">16.2</span>,<span class="number">16.7</span>,<span class="number">15.8</span>,<span class="number">16.2</span>,<span class="number">15.9</span>,</span><br><span class="line">     <span class="number">15.8</span>,<span class="number">15.5</span>,<span class="number">15.9</span>,<span class="number">16.8</span>,<span class="number">15.5</span>,<span class="number">15.8</span>,<span class="number">15.0</span>,<span class="number">14.9</span>,<span class="number">15.3</span>,<span class="number">16.0</span>,</span><br><span class="line">     <span class="number">16.1</span>,<span class="number">16.5</span>,<span class="number">15.5</span>,<span class="number">15.6</span>,<span class="number">16.1</span>,<span class="number">15.6</span>,<span class="number">16.0</span>,<span class="number">15.4</span>,<span class="number">15.5</span>,<span class="number">15.2</span>,</span><br><span class="line">     <span class="number">15.4</span>,<span class="number">15.6</span>,<span class="number">15.1</span>,<span class="number">15.8</span>,<span class="number">15.5</span>,<span class="number">16.0</span>,<span class="number">15.2</span>,<span class="number">15.8</span>,<span class="number">16.2</span>,<span class="number">16.2</span>,</span><br><span class="line">     <span class="number">15.2</span>,<span class="number">15.7</span>,<span class="number">16.0</span>,<span class="number">16.0</span>,<span class="number">15.7</span>,<span class="number">15.9</span>,<span class="number">15.7</span>,<span class="number">16.7</span>,<span class="number">15.3</span>,<span class="number">16.1</span>,<span class="number">16.2</span>]</span><br><span class="line">t = slidet(a,<span class="number">11</span>)</span><br><span class="line"><span class="comment">#绘制图形</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>, <span class="number">4</span>))</span><br><span class="line">ax1 = fig.add_subplot(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">ax1.plot(np.arange(<span class="number">1900</span>,<span class="number">1991</span>,<span class="number">1</span>),t,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">ax1.axhline(<span class="number">2.85</span>) <span class="comment">#显著性水平可通过查阅对应自由度的t分布表得到</span></span><br><span class="line">ax1.axhline(-<span class="number">2.85</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<img src="https://cdn.kesci.com/upload/rt/06B725B7A930472885CE568FC267A8F3/rpnf3jcusu.png">


<h3 id="11-3-2-曼-肯德尔法"><a href="#11-3-2-曼-肯德尔法" class="headerlink" title="11.3.2  曼-肯德尔法"></a>11.3.2  曼-肯德尔法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mktest</span>(<span class="params">x</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(x)</span><br><span class="line">    <span class="comment">#定义累计量序列Sk，长度n，初始值为0</span></span><br><span class="line">    Sk = np.zeros(n)</span><br><span class="line">    s = <span class="number">0</span>    </span><br><span class="line">    <span class="comment">#计算正序列UFK</span></span><br><span class="line">    UF = np.zeros(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,i):</span><br><span class="line">            <span class="keyword">if</span> x[i]&gt;x[j]:</span><br><span class="line">                s += <span class="number">1</span></span><br><span class="line">        Sk[i] = s</span><br><span class="line">        E = i * (i - <span class="number">1</span>)/<span class="number">4</span></span><br><span class="line">        Var = i * (i - <span class="number">1</span>) * (<span class="number">2</span> * i + <span class="number">5</span>)/<span class="number">72</span></span><br><span class="line">        UF[i] = (Sk[i] - E)/np.sqrt(Var)</span><br><span class="line">    <span class="comment">#定义逆序列累计量序列Sk2，长度n，初始值为0</span></span><br><span class="line">    Sk2 = np.zeros(n)</span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    <span class="comment">#计算逆序列，长度为n，初值为0</span></span><br><span class="line">    x2 = x[::-<span class="number">1</span>]    </span><br><span class="line">    UB = np.zeros(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, i):</span><br><span class="line">            <span class="keyword">if</span> x2[i] &gt; x2[j]:</span><br><span class="line">                s += <span class="number">1</span></span><br><span class="line">        Sk2[i] = s</span><br><span class="line">        E = i * (i - <span class="number">1</span>) / <span class="number">4</span></span><br><span class="line">        Var = i * (i - <span class="number">1</span>) * (<span class="number">2</span> * i + <span class="number">5</span>) / <span class="number">72</span></span><br><span class="line">        UB[i] = -(Sk2[i] - E) / np.sqrt(Var)</span><br><span class="line">    UB = UB[::-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> UF, UB</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">x = [<span class="number">15.4</span>,<span class="number">14.6</span>,<span class="number">15.8</span>,<span class="number">14.8</span>,<span class="number">15.0</span>,<span class="number">15.1</span>,<span class="number">15.1</span>,<span class="number">15.0</span>,<span class="number">15.2</span>,<span class="number">15.4</span>,</span><br><span class="line">     <span class="number">14.8</span>,<span class="number">15.0</span>,<span class="number">15.1</span>,<span class="number">14.7</span>,<span class="number">16.0</span>,<span class="number">15.7</span>,<span class="number">15.4</span>,<span class="number">14.5</span>,<span class="number">15.1</span>,<span class="number">15.3</span>,</span><br><span class="line">     <span class="number">15.5</span>,<span class="number">15.1</span>,<span class="number">15.6</span>,<span class="number">15.1</span>,<span class="number">15.1</span>,<span class="number">14.9</span>,<span class="number">15.5</span>,<span class="number">15.3</span>,<span class="number">15.3</span>,<span class="number">15.4</span>,</span><br><span class="line">     <span class="number">15.7</span>,<span class="number">15.2</span>,<span class="number">15.5</span>,<span class="number">15.5</span>,<span class="number">15.6</span>,<span class="number">15.1</span>,<span class="number">15.1</span>,<span class="number">16.0</span>,<span class="number">16.0</span>,<span class="number">16.8</span>,</span><br><span class="line">     <span class="number">16.2</span>,<span class="number">16.2</span>,<span class="number">16.0</span>,<span class="number">15.6</span>,<span class="number">15.9</span>,<span class="number">16.2</span>,<span class="number">16.7</span>,<span class="number">15.8</span>,<span class="number">16.2</span>,<span class="number">15.9</span>,</span><br><span class="line">     <span class="number">15.8</span>,<span class="number">15.5</span>,<span class="number">15.9</span>,<span class="number">16.8</span>,<span class="number">15.5</span>,<span class="number">15.8</span>,<span class="number">15.0</span>,<span class="number">14.9</span>,<span class="number">15.3</span>,<span class="number">16.0</span>,</span><br><span class="line">     <span class="number">16.1</span>,<span class="number">16.5</span>,<span class="number">15.5</span>,<span class="number">15.6</span>,<span class="number">16.1</span>,<span class="number">15.6</span>,<span class="number">16.0</span>,<span class="number">15.4</span>,<span class="number">15.5</span>,<span class="number">15.2</span>,</span><br><span class="line">     <span class="number">15.4</span>,<span class="number">15.6</span>,<span class="number">15.1</span>,<span class="number">15.8</span>,<span class="number">15.5</span>,<span class="number">16.0</span>,<span class="number">15.2</span>,<span class="number">15.8</span>,<span class="number">16.2</span>,<span class="number">16.2</span>,</span><br><span class="line">     <span class="number">15.2</span>,<span class="number">15.7</span>,<span class="number">16.0</span>,<span class="number">16.0</span>,<span class="number">15.7</span>,<span class="number">15.9</span>,<span class="number">15.7</span>,<span class="number">16.7</span>,<span class="number">15.3</span>,<span class="number">16.1</span>,<span class="number">16.2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">uf,ub = mktest(x)</span><br><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>, <span class="number">4</span>))</span><br><span class="line">ax1 = fig.add_subplot(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">ax1.plot(np.arange(<span class="number">1900</span>,<span class="number">1991</span>,<span class="number">1</span>),uf,<span class="string">&#x27;r&#x27;</span>,label=<span class="string">&#x27;UFk&#x27;</span>)</span><br><span class="line">ax1.plot(np.arange(<span class="number">1900</span>,<span class="number">1991</span>,<span class="number">1</span>),ub,<span class="string">&#x27;b&#x27;</span>,label=<span class="string">&#x27;UBk&#x27;</span>)</span><br><span class="line">ax1.legend()</span><br><span class="line">ax1.axhline(<span class="number">1.96</span>)</span><br><span class="line">ax1.axhline(-<span class="number">1.96</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<img src="https://cdn.kesci.com/upload/rt/95A1CB4DD453406BB9A7350EAAA499FE/rpnf3jlf67.png">


<h2 id="11-4-气候变量场时空结构的分离（经验正交函数分解）"><a href="#11-4-气候变量场时空结构的分离（经验正交函数分解）" class="headerlink" title="11.4  气候变量场时空结构的分离（经验正交函数分解）"></a>11.4  气候变量场时空结构的分离（经验正交函数分解）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> eofs.standard <span class="keyword">import</span> Eof</span><br><span class="line"><span class="keyword">import</span> xarray <span class="keyword">as</span> xr</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment">#读入数据</span></span><br><span class="line">f_u = xr.open_dataset(<span class="string">&#x27;/home/mw/input/pythonbook4259/uwnd.mon.mean.nc&#x27;</span>)</span><br><span class="line">u = f_u[<span class="string">&#x27;uwnd&#x27;</span>].loc[f_u.time.dt.month.isin([<span class="number">12</span>,<span class="number">1</span>,<span class="number">2</span>])].loc[<span class="string">&#x27;1961-12-01&#x27;</span>:<span class="string">&#x27;2017-02-28&#x27;</span>].loc[:,<span class="number">1000</span>:<span class="number">100</span>,<span class="number">70</span>:<span class="number">20</span>,<span class="number">60</span>:<span class="number">120</span>]</span><br><span class="line">lon_u = u[<span class="string">&#x27;lon&#x27;</span>]</span><br><span class="line">lat_u = u[<span class="string">&#x27;lat&#x27;</span>]</span><br><span class="line">level = u[<span class="string">&#x27;level&#x27;</span>]</span><br><span class="line">u_array = np.array(u).reshape(<span class="number">56</span>,<span class="number">3</span>,level.shape[<span class="number">0</span>],lat_u.shape[<span class="number">0</span>],lon_u.shape[<span class="number">0</span>]).mean((<span class="number">1</span>,<span class="number">4</span>)).transpose((<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>))</span><br><span class="line"><span class="comment">#EOF分析</span></span><br><span class="line">coslat = np.cos(np.deg2rad(lat_u))</span><br><span class="line">coslat = np.array(coslat)</span><br><span class="line">wgts = np.sqrt(coslat)[..., np.newaxis]</span><br><span class="line">solver = Eof(u_array, weights=wgts)</span><br><span class="line">u_eof = solver.eofsAsCorrelation(neofs=<span class="number">2</span>)</span><br><span class="line">u_pc = solver.pcs(npcs=<span class="number">2</span>, pcscaling=<span class="number">1</span>)</span><br><span class="line">u_var = solver.varianceFraction()</span><br><span class="line">u_eof = u_eof.transpose((<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>))</span><br><span class="line"><span class="comment">#设置PC序列的颜色</span></span><br><span class="line">color1 = []</span><br><span class="line">color2 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1961</span>,<span class="number">2017</span>):</span><br><span class="line">   <span class="keyword">if</span> u_pc[i-<span class="number">1961</span>,<span class="number">0</span>] &gt;=<span class="number">0</span>:</span><br><span class="line">      color1.append(<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">   <span class="keyword">elif</span> u_pc[i-<span class="number">1961</span>,<span class="number">0</span>] &lt;<span class="number">0</span>:</span><br><span class="line">      color1.append(<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">   <span class="keyword">if</span> u_pc[i-<span class="number">1961</span>,<span class="number">1</span>] &gt;=<span class="number">0</span>:</span><br><span class="line">      color2.append(<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">   <span class="keyword">elif</span> u_pc[i-<span class="number">1961</span>,<span class="number">1</span>] &lt;<span class="number">0</span>:</span><br><span class="line">      color2.append(<span class="string">&#x27;blue&#x27;</span>)   </span><br><span class="line"><span class="comment">#绘图    </span></span><br><span class="line">fig1 = plt.figure(figsize=(<span class="number">15</span>,<span class="number">15</span>))</span><br><span class="line">years = <span class="built_in">range</span>(<span class="number">1961</span>, <span class="number">2017</span>)</span><br><span class="line"><span class="comment">#EOF1</span></span><br><span class="line">f1_ax1 = fig1.add_axes([<span class="number">0.1</span>, <span class="number">0.42</span>, <span class="number">0.3</span>, <span class="number">0.2</span>])</span><br><span class="line">f1_ax1.set_title(<span class="string">&#x27;(a) EOf1&#x27;</span>,loc=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">f1_ax1.set_title( <span class="string">&#x27;%.2f%%&#x27;</span> % (u_var[<span class="number">0</span>]*<span class="number">100</span>),loc=<span class="string">&#x27;right&#x27;</span>)</span><br><span class="line">f1_ax1.set_yscale(<span class="string">&#x27;symlog&#x27;</span>)</span><br><span class="line">f1_ax1.set_xticklabels([<span class="string">r&#x27;20$^\degree$&#x27;</span>,<span class="string">r&#x27;30$^\degree$N&#x27;</span>, <span class="string">r&#x27;40$^\degree$N&#x27;</span>,</span><br><span class="line">                    <span class="string">r&#x27;50$^\degree$N&#x27;</span>,<span class="string">r&#x27;60$^\degree$N&#x27;</span>, <span class="string">r&#x27;70$^\degree$N&#x27;</span>])</span><br><span class="line">f1_ax1.set_yticks([<span class="number">1000</span>, <span class="number">500</span>,<span class="number">300</span>, <span class="number">200</span>, <span class="number">100</span>])</span><br><span class="line">f1_ax1.set_yticklabels([<span class="string">&#x27;1000&#x27;</span>,<span class="string">&#x27;500&#x27;</span>,<span class="string">&#x27;300&#x27;</span>,<span class="string">&#x27;200&#x27;</span>,<span class="string">&#x27;100&#x27;</span>])</span><br><span class="line">f1_ax1.invert_yaxis()</span><br><span class="line">f1_ax1.set_ylabel(<span class="string">&#x27;Height (hPa)&#x27;</span>,fontsize=<span class="number">18</span>)</span><br><span class="line">f1_ax1.set_xlabel(<span class="string">&#x27;Latitude&#x27;</span>,fontsize=<span class="number">18</span>)</span><br><span class="line">c1 = f1_ax1.contourf(lat_u,level ,u_eof[<span class="number">0</span>,:,:], levels=np.arange(-<span class="number">0.8</span>,<span class="number">0.9</span>,<span class="number">0.1</span>), extend = <span class="string">&#x27;both&#x27;</span>,</span><br><span class="line">             zorder=<span class="number">0</span>, cmap=plt.cm.RdBu_r)</span><br><span class="line"><span class="comment">#PC1</span></span><br><span class="line">f1_ax2 = fig1.add_axes([<span class="number">0.45</span>, <span class="number">0.42</span>, <span class="number">0.3</span>, <span class="number">0.2</span>])</span><br><span class="line">f1_ax2.set_title(<span class="string">&#x27;(b) PC1&#x27;</span>,loc=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">f1_ax2.set_ylim(-<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">f1_ax2.axhline(<span class="number">0</span>,linestyle=<span class="string">&quot;--&quot;</span>)</span><br><span class="line">f1_ax2.bar(years,u_pc[:,<span class="number">0</span>],color=color1)</span><br><span class="line"><span class="comment">#EOF2</span></span><br><span class="line">f1_ax3 = fig1.add_axes([<span class="number">0.1</span>, <span class="number">0.17</span>, <span class="number">0.3</span>, <span class="number">0.2</span>])</span><br><span class="line">f1_ax3.set_title(<span class="string">&#x27;(c) EOf1&#x27;</span>,loc=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">f1_ax3.set_title( <span class="string">&#x27;%.2f%%&#x27;</span> % (u_var[<span class="number">1</span>]*<span class="number">100</span>),loc=<span class="string">&#x27;right&#x27;</span>)</span><br><span class="line">f1_ax3.set_yscale(<span class="string">&#x27;symlog&#x27;</span>)</span><br><span class="line">f1_ax3.set_xticklabels([<span class="string">r&#x27;20$^\degree$&#x27;</span>,<span class="string">r&#x27;30$^\degree$N&#x27;</span>, <span class="string">r&#x27;40$^\degree$N&#x27;</span>,</span><br><span class="line">                    <span class="string">r&#x27;50$^\degree$N&#x27;</span>,<span class="string">r&#x27;60$^\degree$N&#x27;</span>, <span class="string">r&#x27;70$^\degree$N&#x27;</span>])</span><br><span class="line">f1_ax3.set_yticks([<span class="number">1000</span>, <span class="number">500</span>,<span class="number">300</span>, <span class="number">200</span>, <span class="number">100</span>])</span><br><span class="line">f1_ax3.set_yticklabels([<span class="string">&#x27;1000&#x27;</span>,<span class="string">&#x27;500&#x27;</span>,<span class="string">&#x27;300&#x27;</span>,<span class="string">&#x27;200&#x27;</span>,<span class="string">&#x27;100&#x27;</span>])</span><br><span class="line">f1_ax3.invert_yaxis()</span><br><span class="line">f1_ax3.set_ylabel(<span class="string">&#x27;Height (hPa)&#x27;</span>,fontsize=<span class="number">18</span>)</span><br><span class="line">f1_ax3.set_xlabel(<span class="string">&#x27;Latitude&#x27;</span>,fontsize=<span class="number">18</span>)</span><br><span class="line">c2 = f1_ax3.contourf(lat_u,level ,u_eof[<span class="number">1</span>,:,:], levels=np.arange(-<span class="number">0.8</span>,<span class="number">0.9</span>,<span class="number">0.1</span>), extend = <span class="string">&#x27;both&#x27;</span>,</span><br><span class="line">             zorder=<span class="number">0</span>, cmap=plt.cm.RdBu_r)</span><br><span class="line"><span class="comment">#PC2</span></span><br><span class="line">f1_ax4 = fig1.add_axes([<span class="number">0.45</span>, <span class="number">0.17</span>, <span class="number">0.3</span>, <span class="number">0.2</span>])</span><br><span class="line">f1_ax4.set_title(<span class="string">&#x27;(d) PC2&#x27;</span>,loc=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">f1_ax4.set_ylim(-<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">f1_ax4.axhline(<span class="number">0</span>,linestyle=<span class="string">&quot;--&quot;</span>)</span><br><span class="line">f1_ax4.bar(years,u_pc[:,<span class="number">1</span>],color=color2)</span><br><span class="line"><span class="comment">#色标</span></span><br><span class="line">position=fig1.add_axes([<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.3</span>, <span class="number">0.017</span>])</span><br><span class="line">fig1.colorbar(c1,cax=position,orientation=<span class="string">&#x27;horizontal&#x27;</span>,<span class="built_in">format</span>=<span class="string">&#x27;%.1f&#x27;</span>,)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:42: UserWarning: FixedFormatter should only be used together with FixedLocator
/opt/conda/lib/python3.7/site-packages/ipykernel_launcher.py:62: UserWarning: FixedFormatter should only be used together with FixedLocator
</code></pre>
<img src="https://cdn.kesci.com/upload/rt/E90F8F76D21943148026AF0FE999ED69/rpnf3lkxc.png">

<script src="https://utteranc.es/client.js"
        repo="Nuist666/blog_comment"
        issue-term="python气象信息系统工程 第十一章"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python-%E6%B0%94%E8%B1%A1%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%B7%A5%E7%A8%8B/" rel="tag">python,气象信息系统工程</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/%E5%B0%8F%E4%B9%A6%E5%8C%A0-python/">/小书匠/python</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/6/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2024 Nuist666
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
</body>
</html>